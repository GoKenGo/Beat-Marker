<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Beat Marker Pro</title>
  <style>
    :root {
      --bg-primary: #1e1e1e;
      --bg-secondary: #2a2a2a;
      --bg-tertiary: #333333;
      --bg-input: #1a1a1a;
      --border: #444444;
      --border-focus: #5a9fd4;
      --text-primary: #e0e0e0;
      --text-secondary: #999999;
      --text-muted: #666666;
      --accent: #5a9fd4;
      --accent-hover: #6db3e8;
      --accent-active: #4889b8;
      --danger: #e05555;
      --success: #5aad5a;
      --warning: #d4a45a;
      --radius: 4px;
      --font-mono: 'Consolas', 'SF Mono', 'Monaco', monospace;
      --font-ui: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      --ch-kick: #e05555;
      --ch-snare: #e0a855;
      --ch-hihat: #ccc855;
      --ch-bass: #55b8e0;
      --ch-melody: #a855e0;
      --ch-vocal: #55e0a8;
      --ch-beat: #5a9fd4;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: var(--font-ui); font-size: 11px;
      color: var(--text-primary); background: var(--bg-primary);
      line-height: 1.5; overflow-x: hidden; -webkit-font-smoothing: antialiased;
    }
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: var(--bg-primary); }
    ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
    .panel-container {
      padding: 12px; display: flex; flex-direction: column;
      gap: 10px; min-height: 100vh;
    }
    .panel-header {
      display: flex; align-items: center; gap: 8px;
      padding-bottom: 10px; border-bottom: 1px solid var(--border);
    }
    .panel-header .logo {
      width: 22px; height: 22px; background: var(--accent);
      border-radius: 3px; display: flex; align-items: center;
      justify-content: center; flex-shrink: 0;
    }
    .panel-header .logo svg { width: 14px; height: 14px; fill: white; }
    .panel-header h1 { font-size: 13px; font-weight: 600; letter-spacing: 0.3px; }
    .panel-header .version { font-size: 9px; color: var(--text-muted); margin-left: auto; font-family: var(--font-mono); }

    /* Tabs */
    .tab-bar { display: flex; border-bottom: 1px solid var(--border); }
    .tab-btn {
      flex: 1; height: 30px; background: var(--bg-secondary); border: none;
      border-bottom: 2px solid transparent; color: var(--text-muted);
      font-size: 10px; font-weight: 600; text-transform: uppercase;
      letter-spacing: 0.6px; cursor: pointer; transition: all 0.15s;
    }
    .tab-btn:hover { color: var(--text-secondary); background: var(--bg-tertiary); }
    .tab-btn.active { color: var(--accent); border-bottom-color: var(--accent); background: var(--bg-primary); }
    .tab-panel { display: none; }
    .tab-panel.active { display: flex; flex-direction: column; gap: 10px; }

    /* Sections */
    .section { background: var(--bg-secondary); border: 1px solid var(--border); border-radius: var(--radius); overflow: hidden; }
    .section-header {
      display: flex; align-items: center; justify-content: space-between;
      padding: 7px 10px; background: var(--bg-tertiary);
      border-bottom: 1px solid var(--border); cursor: pointer; user-select: none;
    }
    .section-header:hover { background: #3a3a3a; }
    .section-header h2 { font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.8px; color: var(--text-secondary); }
    .section-header .chevron { font-size: 8px; color: var(--text-muted); transition: transform 0.2s; }
    .section-header.collapsed .chevron { transform: rotate(-90deg); }
    .section-body { padding: 10px; display: flex; flex-direction: column; gap: 8px; }
    .section-body.collapsed { display: none; }

    /* Form */
    .field-row { display: flex; align-items: center; gap: 8px; }
    .field-row label { font-size: 10px; color: var(--text-secondary); min-width: 70px; flex-shrink: 0; }
    .field-row input[type="number"], .field-row input[type="text"], .field-row select {
      flex: 1; height: 26px; background: var(--bg-input); border: 1px solid var(--border);
      border-radius: var(--radius); color: var(--text-primary);
      font-family: var(--font-mono); font-size: 11px; padding: 0 8px; outline: none;
    }
    .field-row input:focus, .field-row select:focus { border-color: var(--border-focus); }
    .field-row select {
      cursor: pointer; -webkit-appearance: none; appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='5'%3E%3Cpath d='M0 0l4 5 4-5z' fill='%23999'/%3E%3C/svg%3E");
      background-repeat: no-repeat; background-position: right 8px center; padding-right: 22px;
    }

    /* BPM */
    .bpm-display { text-align: center; padding: 12px 10px; background: var(--bg-input); border: 1px solid var(--border); border-radius: var(--radius); }
    .bpm-value { font-family: var(--font-mono); font-size: 32px; font-weight: 700; color: var(--accent); line-height: 1; letter-spacing: -1px; }
    .bpm-label { font-size: 9px; text-transform: uppercase; letter-spacing: 1.5px; color: var(--text-muted); margin-top: 2px; }
    .bpm-input-row { display: flex; gap: 6px; }
    .bpm-input-row input {
      flex: 1; height: 28px; background: var(--bg-input); border: 1px solid var(--border);
      border-radius: var(--radius); color: var(--text-primary); font-family: var(--font-mono);
      font-size: 13px; padding: 0 10px; outline: none; text-align: center;
    }
    .bpm-input-row input:focus { border-color: var(--border-focus); }

    /* Audio Drop */
    .audio-dropzone {
      border: 1px dashed var(--border); border-radius: var(--radius);
      padding: 14px; text-align: center; cursor: pointer; transition: all 0.2s; position: relative;
    }
    .audio-dropzone:hover, .audio-dropzone.dragover { border-color: var(--accent); background: rgba(90,159,212,0.05); }
    .audio-dropzone.analyzing { border-color: var(--warning); background: rgba(212,164,90,0.05); }
    .audio-dropzone .drop-icon { font-size: 18px; margin-bottom: 4px; opacity: 0.4; }
    .audio-dropzone .drop-text { font-size: 10px; color: var(--text-muted); }
    .audio-dropzone .drop-text strong { color: var(--accent); }
    .audio-dropzone input[type="file"] { position: absolute; inset: 0; opacity: 0; cursor: pointer; }

    /* Tap */
    .tap-tempo-btn {
      height: 28px; min-width: 76px; background: var(--bg-tertiary);
      border: 1px solid var(--border); border-radius: var(--radius);
      color: var(--text-primary); font-size: 10px; font-weight: 600;
      text-transform: uppercase; letter-spacing: 0.5px; cursor: pointer;
      transition: all 0.1s; position: relative;
    }
    .tap-tempo-btn:hover { background: #404040; }
    .tap-tempo-btn:active, .tap-tempo-btn.tapping { background: var(--accent); border-color: var(--accent); color: white; transform: scale(0.97); }
    .tap-tempo-btn .tap-count { font-family: var(--font-mono); font-size: 8px; color: var(--text-muted); position: absolute; bottom: 2px; right: 4px; }

    /* Detection Channels */
    .channel-row {
      display: flex; align-items: center; gap: 6px; padding: 5px 8px;
      background: var(--bg-input); border: 1px solid var(--border);
      border-radius: var(--radius); transition: all 0.15s;
    }
    .channel-row:hover { border-color: var(--text-muted); }
    .channel-row.disabled { opacity: 0.35; }
    .channel-toggle {
      width: 30px; height: 16px; background: var(--bg-tertiary);
      border: 1px solid var(--border); border-radius: 8px;
      cursor: pointer; position: relative; transition: all 0.2s; flex-shrink: 0;
    }
    .channel-toggle.active { border-color: transparent; }
    .channel-toggle .knob {
      width: 10px; height: 10px; background: var(--text-muted);
      border-radius: 50%; position: absolute; top: 2px; left: 2px; transition: all 0.2s;
    }
    .channel-toggle.active .knob { left: 16px; background: white; }
    .channel-icon {
      width: 16px; height: 16px; border-radius: 3px; flex-shrink: 0;
      display: flex; align-items: center; justify-content: center; font-size: 9px;
    }
    .channel-info { flex: 1; min-width: 0; }
    .channel-name { font-size: 10px; font-weight: 600; }
    .channel-desc { font-size: 8px; color: var(--text-muted); }
    .channel-sensitivity { width: 55px; flex-shrink: 0; }
    .channel-sensitivity input[type="range"] {
      width: 100%; height: 3px; -webkit-appearance: none; appearance: none;
      background: var(--bg-tertiary); border-radius: 2px; outline: none;
    }
    .channel-sensitivity input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none; width: 9px; height: 9px;
      background: var(--text-secondary); border-radius: 50%; cursor: pointer;
    }
    .channel-marker-color select {
      width: 50px; height: 20px; background: var(--bg-tertiary);
      border: 1px solid var(--border); border-radius: 3px;
      color: var(--text-secondary); font-size: 8px; padding: 0 2px;
      outline: none; cursor: pointer; -webkit-appearance: none; appearance: none;
    }
    .channel-count { font-family: var(--font-mono); font-size: 9px; color: var(--text-muted); min-width: 24px; text-align: right; flex-shrink: 0; }

    /* Visualization */
    .analysis-viz { background: var(--bg-input); border: 1px solid var(--border); border-radius: var(--radius); overflow: hidden; }
    .analysis-viz canvas { width: 100%; display: block; }
    .viz-controls { display: flex; gap: 4px; padding: 4px 6px; border-top: 1px solid var(--border); background: var(--bg-secondary); }
    .viz-controls button {
      height: 20px; padding: 0 6px; background: var(--bg-tertiary);
      border: 1px solid var(--border); border-radius: 2px;
      color: var(--text-muted); font-size: 8px; cursor: pointer; text-transform: uppercase;
    }
    .viz-controls button:hover { color: var(--text-primary); }
    .viz-controls button.active { background: var(--accent); border-color: var(--accent); color: white; }

    /* Summary */
    .detection-summary { display: grid; grid-template-columns: repeat(3, 1fr); gap: 4px; }
    .summary-stat { text-align: center; padding: 6px 4px; background: var(--bg-input); border: 1px solid var(--border); border-radius: var(--radius); }
    .summary-stat .stat-val { font-family: var(--font-mono); font-size: 16px; font-weight: 700; line-height: 1; }
    .summary-stat .stat-label { font-size: 8px; text-transform: uppercase; letter-spacing: 0.5px; color: var(--text-muted); margin-top: 2px; }

    /* Progress */
    .progress-bar { height: 3px; background: var(--bg-input); border-radius: 2px; overflow: hidden; display: none; }
    .progress-bar.visible { display: block; }
    .progress-bar .progress-fill { height: 100%; background: var(--accent); border-radius: 2px; transition: width 0.3s; width: 0%; }

    /* Grid controls */
    .subdivision-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 4px; }
    .sub-btn {
      height: 30px; background: var(--bg-input); border: 1px solid var(--border);
      border-radius: var(--radius); color: var(--text-secondary); font-size: 10px;
      cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 1px;
    }
    .sub-btn:hover { border-color: var(--text-muted); color: var(--text-primary); }
    .sub-btn.active { background: var(--accent); border-color: var(--accent); color: white; }
    .sub-btn .note-symbol { font-size: 12px; line-height: 1; }
    .sub-btn .note-label { font-size: 7px; text-transform: uppercase; letter-spacing: 0.3px; }

    .range-options { display: flex; gap: 4px; }
    .range-btn {
      flex: 1; height: 26px; background: var(--bg-input); border: 1px solid var(--border);
      border-radius: var(--radius); color: var(--text-secondary); font-size: 9px;
      font-weight: 500; cursor: pointer;
    }
    .range-btn:hover { border-color: var(--text-muted); color: var(--text-primary); }
    .range-btn.active { background: var(--accent); border-color: var(--accent); color: white; }

    .checkbox-row { display: flex; align-items: center; gap: 6px; cursor: pointer; }
    .checkbox-row input[type="checkbox"] { width: 13px; height: 13px; accent-color: var(--accent); cursor: pointer; }
    .checkbox-row span { font-size: 10px; color: var(--text-secondary); }

    /* Buttons */
    .btn-primary {
      height: 36px; background: var(--accent); border: none; border-radius: var(--radius);
      color: white; font-size: 12px; font-weight: 600; cursor: pointer; transition: all 0.15s;
    }
    .btn-primary:hover { background: var(--accent-hover); }
    .btn-primary:active { background: var(--accent-active); transform: scale(0.98); }
    .btn-primary:disabled { opacity: 0.4; cursor: not-allowed; }
    .btn-secondary {
      height: 28px; background: var(--bg-tertiary); border: 1px solid var(--border);
      border-radius: var(--radius); color: var(--text-secondary); font-size: 10px;
      font-weight: 500; cursor: pointer;
    }
    .btn-secondary:hover { background: #404040; color: var(--text-primary); }
    .btn-danger { height: 28px; background: transparent; border: 1px solid var(--danger); border-radius: var(--radius); color: var(--danger); font-size: 10px; cursor: pointer; }
    .btn-danger:hover { background: rgba(224,85,85,0.1); }
    .btn-row { display: flex; gap: 6px; }
    .btn-row > * { flex: 1; }
    .action-buttons { display: flex; flex-direction: column; gap: 6px; padding-top: 4px; }

    /* Status */
    .status-bar {
      display: flex; align-items: center; gap: 6px; padding: 6px 8px;
      background: var(--bg-secondary); border: 1px solid var(--border);
      border-radius: var(--radius); font-size: 9px; min-height: 28px;
    }
    .status-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--text-muted); flex-shrink: 0; }
    .status-dot.ready { background: var(--success); }
    .status-dot.working { background: var(--warning); animation: pulse 1s infinite; }
    .status-dot.error { background: var(--danger); }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
    .status-text { color: var(--text-muted); font-family: var(--font-mono); flex: 1; }

    .naming-preview { font-family: var(--font-mono); font-size: 9px; color: var(--text-muted); background: var(--bg-input); padding: 5px 8px; border-radius: var(--radius); border: 1px solid var(--border); }
    .hint { font-size: 9px; color: var(--text-muted); font-style: italic; }
    .offset-row { display: flex; gap: 6px; align-items: center; flex: 1; }
    .offset-row input { flex: 1; height: 24px; background: var(--bg-input); border: 1px solid var(--border); border-radius: var(--radius); color: var(--text-primary); font-family: var(--font-mono); font-size: 11px; padding: 0 8px; outline: none; }
    .offset-row .unit-label { font-size: 9px; color: var(--text-muted); }
    .use-playhead-btn { height: 24px; padding: 0 6px; background: var(--bg-tertiary); border: 1px solid var(--border); border-radius: var(--radius); color: var(--text-secondary); font-size: 9px; cursor: pointer; white-space: nowrap; }
    .use-playhead-btn:hover { background: #404040; color: var(--text-primary); }
    .metronome-row { display: flex; align-items: center; gap: 8px; }
    .metronome-toggle { width: 34px; height: 18px; background: var(--bg-input); border: 1px solid var(--border); border-radius: 9px; cursor: pointer; position: relative; transition: all 0.2s; }
    .metronome-toggle.active { background: var(--accent); border-color: var(--accent); }
    .metronome-toggle .toggle-knob { width: 12px; height: 12px; background: var(--text-secondary); border-radius: 50%; position: absolute; top: 2px; left: 2px; transition: all 0.2s; }
    .metronome-toggle.active .toggle-knob { left: 18px; background: white; }
    .beat-indicator { display: flex; gap: 3px; }
    .beat-dot { width: 9px; height: 9px; border-radius: 50%; background: var(--bg-input); border: 1px solid var(--border); }
    .beat-dot.active { background: var(--accent); border-color: var(--accent); box-shadow: 0 0 5px rgba(90,159,212,0.4); }
    .beat-dot.downbeat.active { background: var(--ch-kick); border-color: var(--ch-kick); }
    .divider { height: 1px; background: var(--border); margin: 2px 0; }
    .time-sig-row { display: flex; align-items: center; gap: 4px; }
    .time-sig-row select { width: 48px; height: 24px; background: var(--bg-input); border: 1px solid var(--border); border-radius: var(--radius); color: var(--text-primary); font-family: var(--font-mono); font-size: 12px; text-align: center; outline: none; cursor: pointer; -webkit-appearance: none; padding: 0 4px; }
    .time-sig-row .slash { font-size: 14px; color: var(--text-muted); }
  </style>
</head>
<body>
  <div class="panel-container">
    <div class="panel-header">
      <div class="logo"><svg viewBox="0 0 24 24"><path d="M12 3v18M5 8l7-5 7 5M5 16l7 5 7-5M3 12h18"/></svg></div>
      <h1>Beat Marker Pro</h1>
      <span class="version">v2.0</span>
    </div>

    <div class="tab-bar">
      <button class="tab-btn active" data-tab="detect" onclick="switchTab('detect')">ğŸ¯ Detect</button>
      <button class="tab-btn" data-tab="grid" onclick="switchTab('grid')">ğŸµ Grid</button>
      <button class="tab-btn" data-tab="place" onclick="switchTab('place')">ğŸ“ Place</button>
    </div>

    <!-- TAB: DETECT -->
    <div class="tab-panel active" id="tab-detect">
      <div class="audio-dropzone" id="audioDropzone">
        <div class="drop-icon">â™«</div>
        <div class="drop-text">Drop audio or <strong>click to browse</strong><br/><span style="font-size:8px;color:var(--text-muted);">Analyzes drums, bass, melody, vocals separately</span></div>
        <input type="file" id="audioFileInput" accept="audio/*" />
      </div>
      <div class="progress-bar" id="analysisProgress"><div class="progress-fill" id="analysisProgressFill"></div></div>

      <div class="bpm-display">
        <div class="bpm-value" id="bpmDisplay">â€”</div>
        <div class="bpm-label">Beats Per Minute</div>
      </div>
      <div class="bpm-input-row">
        <input type="number" id="bpmInput" value="" min="20" max="300" step="0.1" placeholder="Manual BPM" />
        <button class="tap-tempo-btn" id="tapTempoBtn" onclick="tapTempo()">TAP<span class="tap-count" id="tapCount"></span></button>
      </div>

      <div class="section">
        <div class="section-header" onclick="toggleSection(this)">
          <h2>Detection Channels</h2><span class="chevron">â–¼</span>
        </div>
        <div class="section-body" style="gap:5px;">
          <div class="channel-row" id="ch-kick">
            <div class="channel-toggle active" data-ch="kick" onclick="toggleChannel('kick')"><div class="knob"></div></div>
            <div class="channel-icon" style="background:var(--ch-kick);">ğŸ¥</div>
            <div class="channel-info"><div class="channel-name">Kick</div><div class="channel-desc">20-300Hz Â· bass drum</div></div>
            <div class="channel-sensitivity"><input type="range" min="0" max="100" value="50" data-ch="kick" oninput="updateSensitivity('kick',this.value)" /></div>
            <div class="channel-marker-color"><select data-ch="kick" onchange="updateChannelColor('kick',this.value)"><option value="1" selected>Red</option><option value="0">Green</option><option value="3">Orange</option><option value="4">Yellow</option><option value="6">Blue</option></select></div>
            <div class="channel-count" data-ch="kick">â€”</div>
          </div>
          <div class="channel-row" id="ch-snare">
            <div class="channel-toggle active" data-ch="snare" onclick="toggleChannel('snare')"><div class="knob"></div></div>
            <div class="channel-icon" style="background:var(--ch-snare);">ğŸª˜</div>
            <div class="channel-info"><div class="channel-name">Snare</div><div class="channel-desc">300-6kHz Â· crack + body</div></div>
            <div class="channel-sensitivity"><input type="range" min="0" max="100" value="50" data-ch="snare" oninput="updateSensitivity('snare',this.value)" /></div>
            <div class="channel-marker-color"><select data-ch="snare" onchange="updateChannelColor('snare',this.value)"><option value="3" selected>Orange</option><option value="0">Green</option><option value="1">Red</option><option value="4">Yellow</option><option value="6">Blue</option></select></div>
            <div class="channel-count" data-ch="snare">â€”</div>
          </div>
          <div class="channel-row" id="ch-hihat">
            <div class="channel-toggle" data-ch="hihat" onclick="toggleChannel('hihat')"><div class="knob"></div></div>
            <div class="channel-icon" style="background:var(--ch-hihat);">ğŸ””</div>
            <div class="channel-info"><div class="channel-name">Hi-Hat</div><div class="channel-desc">6-20kHz Â· cymbals</div></div>
            <div class="channel-sensitivity"><input type="range" min="0" max="100" value="50" data-ch="hihat" oninput="updateSensitivity('hihat',this.value)" /></div>
            <div class="channel-marker-color"><select data-ch="hihat" onchange="updateChannelColor('hihat',this.value)"><option value="4" selected>Yellow</option><option value="0">Green</option><option value="1">Red</option><option value="3">Orange</option><option value="6">Blue</option></select></div>
            <div class="channel-count" data-ch="hihat">â€”</div>
          </div>
          <div class="channel-row" id="ch-bass">
            <div class="channel-toggle active" data-ch="bass" onclick="toggleChannel('bass')"><div class="knob"></div></div>
            <div class="channel-icon" style="background:var(--ch-bass);">ğŸ¸</div>
            <div class="channel-info"><div class="channel-name">Bass</div><div class="channel-desc">20-300Hz Â· bass note changes</div></div>
            <div class="channel-sensitivity"><input type="range" min="0" max="100" value="50" data-ch="bass" oninput="updateSensitivity('bass',this.value)" /></div>
            <div class="channel-marker-color"><select data-ch="bass" onchange="updateChannelColor('bass',this.value)"><option value="6" selected>Blue</option><option value="0">Green</option><option value="1">Red</option><option value="7">Cyan</option></select></div>
            <div class="channel-count" data-ch="bass">â€”</div>
          </div>
          <div class="channel-row" id="ch-melody">
            <div class="channel-toggle" data-ch="melody" onclick="toggleChannel('melody')"><div class="knob"></div></div>
            <div class="channel-icon" style="background:var(--ch-melody);">ğŸ¹</div>
            <div class="channel-info"><div class="channel-name">Melody</div><div class="channel-desc">300-6kHz Â· pitch changes</div></div>
            <div class="channel-sensitivity"><input type="range" min="0" max="100" value="45" data-ch="melody" oninput="updateSensitivity('melody',this.value)" /></div>
            <div class="channel-marker-color"><select data-ch="melody" onchange="updateChannelColor('melody',this.value)"><option value="2" selected>Purple</option><option value="0">Green</option><option value="1">Red</option><option value="3">Orange</option><option value="6">Blue</option></select></div>
            <div class="channel-count" data-ch="melody">â€”</div>
          </div>
          <div class="channel-row" id="ch-vocal">
            <div class="channel-toggle" data-ch="vocal" onclick="toggleChannel('vocal')"><div class="knob"></div></div>
            <div class="channel-icon" style="background:var(--ch-vocal);">ğŸ¤</div>
            <div class="channel-info"><div class="channel-name">Vocal</div><div class="channel-desc">300-4kHz Â· phrase onsets</div></div>
            <div class="channel-sensitivity"><input type="range" min="0" max="100" value="45" data-ch="vocal" oninput="updateSensitivity('vocal',this.value)" /></div>
            <div class="channel-marker-color"><select data-ch="vocal" onchange="updateChannelColor('vocal',this.value)"><option value="0" selected>Green</option><option value="1">Red</option><option value="2">Purple</option><option value="7">Cyan</option></select></div>
            <div class="channel-count" data-ch="vocal">â€”</div>
          </div>
        </div>
      </div>

      <div class="analysis-viz" id="analysisViz" style="display:none;">
        <canvas id="vizCanvas" height="100"></canvas>
        <div class="viz-controls">
          <button class="active" data-viz="waveform" onclick="setVizMode('waveform',this)">Waveform</button>
          <button data-viz="onsets" onclick="setVizMode('onsets',this)">Onsets</button>
          <button data-viz="spectrum" onclick="setVizMode('spectrum',this)">Spectrum</button>
        </div>
      </div>

      <div class="detection-summary" id="detectionSummary" style="display:none;">
        <div class="summary-stat"><div class="stat-val" id="sumTotal" style="color:var(--accent);">0</div><div class="stat-label">Total</div></div>
        <div class="summary-stat"><div class="stat-val" id="sumBPM" style="color:var(--ch-kick);">â€”</div><div class="stat-label">BPM</div></div>
        <div class="summary-stat"><div class="stat-val" id="sumDuration" style="color:var(--ch-melody);">â€”</div><div class="stat-label">Duration</div></div>
      </div>
    </div>

    <!-- TAB: GRID -->
    <div class="tab-panel" id="tab-grid">
      <div class="hint">Evenly-spaced markers from BPM grid (no audio analysis needed)</div>
      <div class="field-row">
        <label>Time Sig</label>
        <div class="time-sig-row">
          <select id="timeSigTop"><option value="2">2</option><option value="3">3</option><option value="4" selected>4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option></select>
          <span class="slash">/</span>
          <select id="timeSigBottom"><option value="4" selected>4</option><option value="8">8</option></select>
        </div>
      </div>
      <label style="font-size:10px;color:var(--text-secondary);">Subdivision</label>
      <div class="subdivision-grid">
        <button class="sub-btn" data-sub="1" onclick="setSubdivision(this,1)"><span class="note-symbol">ğ…</span><span class="note-label">Whole</span></button>
        <button class="sub-btn" data-sub="2" onclick="setSubdivision(this,2)"><span class="note-symbol">ğ…—ğ…¥</span><span class="note-label">Half</span></button>
        <button class="sub-btn active" data-sub="4" onclick="setSubdivision(this,4)"><span class="note-symbol">â™©</span><span class="note-label">Quarter</span></button>
        <button class="sub-btn" data-sub="8" onclick="setSubdivision(this,8)"><span class="note-symbol">â™ª</span><span class="note-label">Eighth</span></button>
      </div>
      <div class="checkbox-row" onclick="document.getElementById('tripletToggle').checked=!document.getElementById('tripletToggle').checked;state.triplet=document.getElementById('tripletToggle').checked;">
        <input type="checkbox" id="tripletToggle" /><span>Triplet grid (swing / shuffle)</span>
      </div>
      <div class="metronome-row">
        <label style="font-size:10px;color:var(--text-secondary);min-width:70px;">Preview</label>
        <div class="metronome-toggle" id="metronomeToggle" onclick="toggleMetronome()"><div class="toggle-knob"></div></div>
        <div class="beat-indicator" id="beatIndicator"><div class="beat-dot downbeat"></div><div class="beat-dot"></div><div class="beat-dot"></div><div class="beat-dot"></div></div>
      </div>
    </div>

    <!-- TAB: PLACE -->
    <div class="tab-panel" id="tab-place">
      <label style="font-size:10px;color:var(--text-secondary);">Timeline Range</label>
      <div class="range-options">
        <button class="range-btn active" data-range="inout" onclick="setRange(this,'inout')">In / Out</button>
        <button class="range-btn" data-range="playhead" onclick="setRange(this,'playhead')">From Playhead</button>
        <button class="range-btn" data-range="full" onclick="setRange(this,'full')">Full Seq</button>
      </div>
      <div class="field-row">
        <label>Offset</label>
        <div class="offset-row">
          <input type="number" id="offsetFrames" value="0" step="1" />
          <span class="unit-label">fr</span>
          <button class="use-playhead-btn" onclick="usePlayheadAsOffset()">â Playhead</button>
        </div>
      </div>
      <div class="field-row">
        <label>Name Pattern</label>
        <input type="text" id="namePattern" value="{type} {bar}.{beat}" placeholder="{type} {bar}.{beat}" />
      </div>
      <div class="naming-preview" id="namingPreview">â†’ Kick 1.1, Snare 1.3, Bass 2.1 ...</div>
      <div class="divider"></div>
      <div class="action-buttons">
        <button class="btn-primary" id="placeDetectedBtn" onclick="placeDetectedMarkers()">ğŸ¯ Place Detected Markers</button>
        <button class="btn-primary" id="placeGridBtn" onclick="placeGridMarkers()" style="background:var(--bg-tertiary);border:1px solid var(--accent);color:var(--accent);">ğŸµ Place Grid Markers</button>
        <div class="btn-row">
          <button class="btn-secondary" onclick="clearLastBatch()">Undo Last</button>
          <button class="btn-danger" onclick="clearAllMarkers()">Clear All</button>
        </div>
      </div>
      <div class="hint" style="text-align:center;">Detected markers require audio analysis Â· Grid markers use BPM</div>
    </div>

    <div class="status-bar">
      <div class="status-dot ready" id="statusDot"></div>
      <span class="status-text" id="statusText">Ready â€” drop audio to detect beats, bass, and melody</span>
    </div>
  </div>

  <script src="js/CSInterface.js"></script>
  <script src="js/audio-analyzer.js"></script>
  <script src="js/main.js"></script>
</body>
</html>
